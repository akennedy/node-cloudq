// cloudq bulk update api
// cloudq run couchdb views
var flatiron = require('flatiron'),
  request = require('request'),
  connect = require('connect'),
  //auth = require('http-auth'),
  url = require('url'),
  app = flatiron.app;

var cloudq = process.env.COUCH || 'http://localhost:5984/cloudq'

// cloudq web site
app.router.post('/users', function(){
  var self = this;
  this.req.body.type = 'user';
  this.req.body._id = this.req.body.name;

  request.post(cloudq, {json: this.req.body}, function(e,r,b) {
    if(e || r.statusCode >= 300) {
      self.res.writeHead(500, { 'Content-Type': 'application/json' });
      self.res.end(JSON.stringify({status: 'error', error: b}));
    } else {
      self.res.writeHead(200, { 'Content-Type': 'application/json' });
      self.res.end(JSON.stringify({status: 'success'}));
    }
  });
});
